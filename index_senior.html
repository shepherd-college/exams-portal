<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="fav_icon2.ico">
    <title>cbt.wisdomschools.org</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Keep all your existing styles intact */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
       
        :root {
            --primary-color: #008000;
            --secondary-color: #d90000;
            --background-color: rgb(50,125,50);
            --text-color: #333;
            --card-bg: white;
            --header-bg: rgb(50,125,50);
            --header-text: white;
            --nav-bg: #006400;
            --input-border: #ddd;
        }
       
        .dark-theme {
            --primary-color: #4CAF50;
            --secondary-color: #ff5252;
            --background-color: #2c2c2c;
            --text-color: #f0f0f0;
            --card-bg: #3c3c3c;
            --header-bg: rgb(50,125,50);
            --header-text: #f0f0f0;
            --nav-bg: #1b5e20;
            --input-border: #555;
        }
       
        body {
            position: relative;
            z-index: 1;
        }
       
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('img/wisdom_logo1.png') no-repeat center center;
            background-size: 300px 300px;
            opacity: 0.1;
            z-index: 0;
            pointer-events: none;
            background-color: white;
            align-items: center;
            text-align: center;
        }
       
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
       
        nav {
            background-color: var(--nav-bg);
            padding: 15px 0;
            margin-bottom: 25px;
            border-radius: 8px;
        }
       
        #student-image {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            display: block;
            margin: 0 auto;
            margin-bottom: 10px;
        }
       
        header {
            background-color: gold;
            color: var(--header-text);
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 25px;
            position: relative;
        }
       
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
       
        .logo {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-weight: bold;
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
        }
       
        .welcome-message {
            background-color: var(--card-bg);
            padding: 15px;
            border-left: 5px solid var(--secondary-color);
            margin: 20px 0;
            font-size: 16px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
       
        .welcome-message img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: block;
            margin: 0 auto;
            border: 3px solid var(--primary-color);
        }
       
        .exam-sections {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
       
        .exam-section {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            flex: 1;
            overflow: hidden;
            min-width: 300px;
        }
       
        .section-header {
            background-color: gold;
            color: var(--header-text);
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
        }
       
        .section-body {
            padding: 25px;
        }
       
        select, input[type="password"] {
            width: 100%;
            max-width: 400px;
            padding: 12px 15px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 16px;
            margin-bottom: 15px;
            text-align: center;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
       
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
            margin: 5px;
        }
       
        .btn:hover {
            background-color: var(--nav-bg);
        }
       
        .btn-secondary {
            background-color: #007bff;
        }
       
        .btn-secondary:hover {
            background-color: #0056b3;
        }
       
        .btn-danger {
            background-color: #dc3545;
        }
       
        .btn-danger:hover {
            background-color: #c82333;
        }
       
        .windows-activate {
            text-align: center;
            margin-top: 30px;
            color: var(--text-color);
            font-size: 14px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
       
        @media (max-width: 900px) {
            .exam-sections {
                flex-direction: column;
            }
        }
       
        .logout-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            background-color: crimson;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
       
        .admin-btn {
            position: absolute;
            left: 20px;
            top: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
       
        .attempt-status {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
       
        .completed {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
       
        .available {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="admin-btn" onclick="goToAdmin()">Admin Panel</button>
            <button class="logout-btn" onclick="logout()">Logout</button>
            <div class="logo-container">
                <div class="logo">
                    <img src="img/wisdom_logo1.jpg" alt="School Logo">
                </div>
            </div>
            <p>2025/2026 FIRST TERM COMPUTER BASED TEST EXAMINATION</p>
        </header>
       
        <div class="welcome-message">
            <img id="userImage" src="img/default_user.jpg" alt="Student Photo"><br>
            <h2>WELCOME: <span id="user">Student</span></h2>
            <div id="attemptStatus" class="attempt-status"></div>
        </div>

        <!-- 3 selection boxes side by side -->
        <div class="exam-sections">
            <div class="exam-section">
                <div class="section-header">SELECT CLASS ‚ñ°</div>
                <div class="section-body">
                    <label>Select Class:</label>
                    <select id="classSelect" onchange="updateAttemptStatus()">
                        <option value="">-- Select Class --</option>
                        <option value="ss1">SS1 (Senior Secondary School 1)</option>
                        <option value="ss2">SS2 (Senior Secondary School 2)</option>
                        <option value="ss3">SS3 (Senior Secondary School 3)</option>
                    </select>
                </div>
            </div>
           
            <div class="exam-section">
                <div class="section-header">SELECT SUBJECT ‚ñ°</div>
                <div class="section-body">
                    <label>Select Subject:</label>
                    <select id="subjectSelect" onchange="updateAttemptStatus()">
                        <option value="">-- Select Subject --</option>
                           <option value="demo">Demmo</option>
                         <option value="mathematics">Mathematics</option>
                        <option value="english_language">English Language</option>
                        <option value="citizenship_education">Citizenship Education</option>
                        <option value="physics">Physics</option>
                        <option value="digital_technology">Digital & Computer Technology</option>
                        <option value="economics">Economics</option>
                        <option value="livestock_farming">Livestock Farming</option>
                        <option value="chemistry">Chemistry</option>
                        <option value="biology">Biology</option>
                        <option value="cultural_art">Cultural & Creative Art</option>
                        <option value="yoruba">Yoruba</option>
                        <option value="geography">Geography</option>
                        <option value="crs">Christian Religious Studies</option>
                        <option value="account">Financial Acounting</option>
                        <option value="government">Government</option>
                        <option value="commerce">Commerce</option>
                        <option value="literature_in_english">Literature in English</option>
                        <option value="marketing">Marketing</option>
                        <option value="fine_art">Fine Art</option>
                        <option value="phonics">Phonics</option>
                        <option value="further_mathematics">Further Mathematics</option>
                        <option value="music">Music</option>
                        <option value="history">Nigerian History</option>
                    </select>
                </div>
            </div>
           
            <div class="exam-section">
                <div class="section-header">SELECT EXAM TYPE ‚ñ°</div>
                <div class="section-body">
                    <label>Select Exam Type:</label>
                    <select id="typeSelect">
                        <option value="objectives">Objectives/Theory</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ‚úÖ PASSWORD SECTION MOVED BELOW -->
        <div class="exam-section" style="max-width: 500px; margin: 0 auto;">
            <div class="section-header">ENTER PASSWORD ‚ñ°</div>
            <div class="section-body">
                <label style="color: var(--secondary-color);">Enter Password:</label>
                <input type="password" id="examPassword" placeholder="Enter subject password">
            </div>
        </div>
       
        <center>
            <button class="btn" id="startExamBtn" onclick="startExam()">
                <i class="fa-solid fa-play"></i> Start Exam
            </button>
        </center>
       
        <div class="windows-activate">
            <p>&copy; 2025 cbt.wisdomschools.org</p>
        </div>
    </div>

    <script>
        const username = sessionStorage.getItem('username');
        const imageName = sessionStorage.getItem('image');
        const password = sessionStorage.getItem('password');
       
        // Redirect if not logged in
        if (!username) {
            alert("Please log in first.");
            window.location.href = "index.html";
        }
       
        document.getElementById('user').innerText = username || 'Student';
        document.getElementById('userImage').src = imageName ? 'img/' + imageName : 'img/default_user.jpg';

        const subjectPasswords = {
              demo:"demo",
              mathematics: "math123",                                                              
              english_language: "eng123",                                                           
              citizenship_education: "abc123",                                                              
              physics: "abc123",                                                               
              digital_technology: "abc123",                                                           
              economics: "eco123",                                                               
              livestock_farming: "liv123",                                                               
              chemistry: "chem123",                                                               
              biology: "bio123",                                                             
              cultural_art: "art123",                                                               
              yoruba: "yor789",                                                               
              geography: "goe456",                                                              
              crs: "abc123",                                                               
              account: "acc123",                                                               
              government: "govt123",                                                               
              commerce: "comm123",                                                              
              literature_in_english: "lit123",                                                               
              marketing: "mkt123",                                                               
              fine_art: "art123",                                                              
              phonics: "pho123",                                                          
              further_mathematics: "fmath123",                                                              
              music: "mus123",
              history:"his123"
        };

  

        // ‚úÖ Mark exam as completed
        function markExamCompleted(cls, sub, username) {
            const attempts = getExamAttempts(cls);
            if (!attempts[username]) {
                attempts[username] = {};
            }
            attempts[username][sub] = true;
            saveExamAttempts(cls, attempts);
        }

        
        // ‚úÖ Enhanced attempt tracking system
        function getExamAttempts(cls) {
            const key = `${cls}_exam_attempts`;
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : {};
        }

        function saveExamAttempts(cls, data) {
            const key = `${cls}_exam_attempts`;
            localStorage.setItem(key, JSON.stringify(data));
        }

        function hasCompletedExam(cls, sub, username) {
            const attempts = getExamAttempts(cls);
            return attempts[username] && attempts[username][sub] === true;
        }

        function updateAttemptStatus() {
            const cls = document.getElementById("classSelect").value.toLowerCase();
            const sub = document.getElementById("subjectSelect").value.toLowerCase();
            const statusElement = document.getElementById("attemptStatus");
           
            if (!cls || !sub) {
                statusElement.innerHTML = "Please select both class and subject";
                statusElement.className = "attempt-status";
                return;
            }
           
            if (hasCompletedExam(cls, sub, username)) {
                statusElement.innerHTML = "‚ùå You have already completed this exam.";
                statusElement.className = "attempt-status completed";
            } else {
                statusElement.innerHTML = "‚úÖ This exam is available for you to take";
                statusElement.className = "attempt-status available";
            }
        }

        // üöÄ Updated start exam function
        /*function startExam() {
            const cls = document.getElementById("classSelect").value.toLowerCase();
            const sub = document.getElementById("subjectSelect").value.toLowerCase();
            const type = document.getElementById("typeSelect").value.toLowerCase();
            const pass = document.getElementById("examPassword").value.trim();
           
            if (!cls || !sub || !pass) {
                alert("Please complete all selections before starting your exam.");
                return;
            }
           
            const correctPassword = subjectPasswords[sub];
            if (pass !== correctPassword) {
                alert("‚ùå Incorrect password for this subject!");
                return;
            }
           
            // ‚úÖ Check if already completed before redirecting
            if (hasCompletedExam(cls, sub, username)) {
                alert("‚ö†Ô∏è You have already completed this exam.");
                window.location.href = "exam_attempted.html";
                return;
            }
           
            // üß† Not completed ‚Üí allow to start exam
            sessionStorage.setItem("class", cls);
            sessionStorage.setItem("subject", sub);
            sessionStorage.setItem("type", type);
            sessionStorage.setItem("examInfo", `${formatSubjectName(sub)} - ${cls.toUpperCase()} (FIRST TERM)`);
           
            // Store in localStorage for results page
            localStorage.setItem("examClass", cls);
            localStorage.setItem("examSubject", formatSubjectName(sub));
            localStorage.setItem("pendingAttempt", "true"); // Mark that attempt is pending confirmation

            const redirectUrl = `${cls}_${sub}_exam.html`; // Your existing exam page
            alert(`‚úÖ Access granted! Redirecting to exam...`);
            window.location.href = redirectUrl;
        }*/
         function startExam() {
		    const cls = document.getElementById("classSelect").value.toLowerCase();
		    const sub = document.getElementById("subjectSelect").value.toLowerCase();
		    const type = document.getElementById("typeSelect").value.toLowerCase();
		    const pass = document.getElementById("examPassword").value.trim();

		    if (!cls || !sub || !pass) {
		        alert("Please complete all selections before starting your exam.");
		        return;
		    }

		    const correctPassword = subjectPasswords[sub];
		    if (pass !== correctPassword) {
		        alert("‚ùå Incorrect password for this subject!");
		        return;
		    }

		    // Check completed exam
		    if (hasCompletedExam(cls, sub, username)) {
		        alert("‚ö†Ô∏è You have already completed this exam.");
		        window.location.href = "exam_attempted.html";
		        return;
		    }

		    // Save data
		    sessionStorage.setItem("class", cls);
		    sessionStorage.setItem("subject", sub);
		    sessionStorage.setItem("type", type);
		    sessionStorage.setItem("examInfo", `${formatSubjectName(sub)} - ${cls.toUpperCase()} (FIRST TERM)`);

		    localStorage.setItem("examClass", cls);
		    localStorage.setItem("examSubject", formatSubjectName(sub));
		    localStorage.setItem("pendingAttempt", "true");

		    const redirectUrl = `${cls}_${sub}_exam.html`;

		    // üîç CHECK IF THE FILE EXISTS BEFORE REDIRECTING
		    fetch(redirectUrl, { method: "HEAD" })
		        .then(response => {
		            if (response.ok) {
		                // File exists ‚Üí redirect normally
		                alert(`‚úÖ Access granted! Redirecting to exam...`);
		                window.location.href = redirectUrl;
		            } else {
		                // File missing ‚Üí send user to landing page
		                alert("‚ö†Ô∏è Exam page not available yet. Redirecting...");
		                window.location.href = "landing.html";
		            }
		        })
		        .catch(() => {
		            // If fetch fails completely
		            alert("‚ö†Ô∏è Exam page not available yet. Redirecting...");
		            window.location.href = "landing.html";
		        });
		}



        function formatSubjectName(subject) {
            const subjectMap = {
              'mathematics':  'mathematics',                                                                                
              'english_language':'english_language',                                                                             
              'citizenship_education':'citizenship_education',                                                                              
              'physics':'physics',                                                                                 
              'digital_technology':'digital_technology',                                                                             
              'economics':'economics',                                                                                
              'livestock_farming':'livestock_farming',                                                                                  
              'chemistry':'chemistry',                                                                                 
              'biology':'biology',                                                                              
              'cultural_art':'cultural_art',                                                                                 
              'yoruba':'yoruba',                                                                                 
              'geography':'geography',                                                                                
              'crs':'crs',                                                                                 
              'account':'account',                                                                                 
              'government':'government',                                                                                 
              'commerce':'commerce',                                                                                
              'literature_in_english':'literatur english',                                                                                 
              'marketing':'marketing',                                                                                 
              'fine_art':'fine_art',                                                                                
              'phonics':'phonics',                                                                            
              'further_mathematics':'further_mathematics',                                                                                
              'music':'music',                                 
              'history':'history',
              'demo':'demo'
            };
           
            return subjectMap[subject] || subject.charAt(0).toUpperCase() + subject.slice(1).replace(/_/g, ' ');
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'index.html';
        }

        function goToAdmin() {
            window.location.href = 'admin.html';
        }
    </script>
</body>
</html>
